(()=>{var t={641:t=>{t.exports='\x3c!-- capture.html --\x3e\r\n<!doctype html>\r\n<html lang="en">\r\n<head>\r\n    <meta charset="UTF-8"/>\r\n    <title>Capture Screen Area</title>\r\n    <style>\r\n        .panels {\r\n            display: flex;\r\n            column-gap: 16px;\r\n        }\r\n        .color-block {\r\n            width: 16px;\r\n            height: 16px;\r\n            cursor: pointer;\r\n            box-sizing: border-box;\r\n            position: relative;\r\n        }\r\n\r\n        .color-block::after {\r\n            content: \'\';\r\n            display: none;\r\n            position: absolute;\r\n            width: 8px;\r\n            height: 8px;\r\n            background: #fff;\r\n            top: 4px;\r\n            left: 4px;\r\n        }\r\n\r\n        .color-block:hover::after {\r\n            display: block;\r\n        }\r\n\r\n        .color-block.selected::after {\r\n            display: block;\r\n        }\r\n\r\n        .line-dot {\r\n            border-radius: 50%;\r\n            background: gray;\r\n            cursor: pointer;\r\n        }\r\n\r\n        .line-dot.selected, .line-dot:hover {\r\n            background-color: #00b400;\r\n        }\r\n\r\n        #screenshot-editor-toolbar button {\r\n            background: none;\r\n            border: none;\r\n            cursor: pointer;\r\n            width: 20px;\r\n            height: 20px;\r\n            box-sizing: content-box;\r\n            margin-right: 15px;\r\n        }\r\n\r\n        #screenshot-editor-toolbar button img {\r\n            width: 20px;\r\n            height: 20px;\r\n        }\r\n\r\n        #screenshot-editor-toolbar button[disabled] {\r\n            cursor: not-allowed;\r\n        }\r\n\r\n        #screenshot-editor-toolbar button[disabled] img {\r\n            filter: grayscale(100%) brightness(1.4);\r\n        }\r\n    </style>\r\n</head>\r\n<body>\r\n<div\r\n        id="overlay"\r\n        style="\r\n        position: fixed;\r\n        top: 0;\r\n        left: 0;\r\n        width: 100vw;\r\n        height: 100vh;\r\n        box-sizing: border-box;\r\n        background-color: transparent;\r\n      "\r\n></div>\r\n<div id="draw-config-panel" style="\r\n  position: absolute;\r\n  display: none;\r\n  background: #fff;\r\n  border: 1px solid #ccc;\r\n  border-radius: 4px;\r\n  padding: 8px;\r\n  z-index: 99999;\r\n  font-size: 12px;\r\n  box-shadow: 0 2px 10px rgba(0,0,0,0.15);\r\n">\r\n    <div class="panels">\r\n        <div id="lineWidthOptions" style="display: flex; gap: 10px; align-items: center;">\r\n            <div class="line-dot" data-width="2" style="width: 7px; height: 7px;"></div>\r\n            <div class="line-dot" data-width="4" style="width: 10px; height: 10px;"></div>\r\n            <div class="line-dot" data-width="6" style="width: 13px; height: 13px;"></div>\r\n        </div>\r\n        <div id="colorOptions" style="display: flex; gap: 6px;">\r\n            <div class="color-block" data-color="#ff4d4f" style="background: #ff4d4f;"></div>\r\n            <div class="color-block" data-color="#fadb14" style="background: #fadb14;"></div>\r\n            <div class="color-block" data-color="#1890ff" style="background: #1890ff;"></div>\r\n            <div class="color-block" data-color="#52c41a" style="background: #52c41a;"></div>\r\n            <div class="color-block" data-color="#000000" style="background: #000000;"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<script>var CaptureApp;(()=>{"use strict";var t={819:t=>{t.exports=require("electron")}},e={};function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,i,a,c,l=[],r=!0,d=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;r=!1}else for(;!(r=(o=a.call(n)).done)&&(l.push(o.value),l.length!==e);r=!0);}catch(t){d=!0,i=t}finally{try{if(!r&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(d)throw i}}return l}}(t,e)||i(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=i(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,a=function(){};return{s:a,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,l=!0,r=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return l=t.done,t},e:function(t){r=!0,c=t},f:function(){try{l||null==n.return||n.return()}finally{if(r)throw c}}}}function i(t,e){if(t){if("string"==typeof t)return a(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var c,l,r,d,s,u,h,p=function n(o){var i=e[o];if(void 0!==i)return i.exports;var a=e[o]={exports:{}};return t[o](a,a.exports,n),a.exports}(819).ipcRenderer,m=function(t){return"screenshot-plugin/".concat(t)},y="zh",g={zh:{rect:"方框",ellipse:"椭圆",arrow:"箭头",pen:"画笔",mosaic:"马赛克",text:"文字",undo:"撤销",download:"下载",cancel:"退出",confirm:"完成",fontSizeSmall:"小",fontSizeMedium:"中",fontSizeLarge:"大"},en:{rect:"Rectangle",ellipse:"Ellipse",arrow:"Arrow",pen:"Pen",mosaic:"Mosaic",text:"Text",undo:"Undo",download:"Download",cancel:"Cancel",confirm:"Confirm",fontSizeSmall:"Small",fontSizeMedium:"Medium",fontSizeLarge:"Large"}},f=null,w=null,v=!1,b=!1,x=!1,I=null,M=0,S=0,C=null,k=0,z=0,D=!1,T=[],N=!1,W=0,P=0,A=[],L={strokeColor:"#ff4d4f",lineWidth:2,fontSize:18},Y=!1,Z=!1,E=null,H=!1,R=0,j=0,B=null,_=null,J="#07c160",G=null;window.onload=function(){console.log("1111"),v=!0,ht(),pt(),p.send(m("capture-window-ready")),setTimeout((function(){p.send(m("force-window-top"))}),500)};var X=lt("div","screenshot-editor-toolbar",{position:"absolute",zIndex:99999,background:"#fff",borderRadius:"6px",padding:"10px 0 10px 15px",boxShadow:"0 2px 10px rgba(0,0,0,0.2)",display:"none",color:"#333",fontFamily:"sans-serif",height:"20px",minWidth:"320px",whiteSpace:"nowrap",overflow:"visible"});document.body.appendChild(X);var O=lt("div","text-config-panel",{position:"absolute",zIndex:99999,background:"#fff",border:"1px solid #ccc",padding:"6px 10px",borderRadius:"4px",display:"none",fontSize:"14px"});document.body.appendChild(O),pt();var Q=document.getElementById("overlay"),V=null,U=lt("canvas",null,{position:"fixed",border:"none",zIndex:9999,pointerEvents:"none",display:"block"});U.width=150,U.height=190,document.body.appendChild(U);var F=U.getContext("2d"),q=document.querySelectorAll("#colorOptions .color-block");q.forEach((function(t){t.addEventListener("click",(function(){q.forEach((function(t){return t.classList.remove("selected")})),t.classList.add("selected"),L.strokeColor=t.dataset.color}))}));var K=document.querySelectorAll("#lineWidthOptions .line-dot");function $(){var t=document.getElementById("draw-config-panel");t&&(t.style.display="none")}function tt(){p.send(m("screenshot-window-unlock")),B&&(B.remove(),B=null,_=null),f&&(f.remove(),f=null,w=null),window._markupContainer&&(window._markupContainer.remove(),window._markupContainer=null),A=[],(T=[]).push(JSON.parse(JSON.stringify(A))),u&&(u.remove(),u=null),U&&(U.style.display="none"),X.style.display="none",window._captureMaskCanvas&&(window._captureMaskCanvas.remove(),window._captureMaskCanvas=null,window._captureMaskCtx=null),p.send(m("capture-cancel")),Y=!1,Z=!1,H=!1,E="",L={strokeColor:"red",lineWidth:2},b=!1,c=0,l=0,r=0,d=0,window._captureTempData=null,document.body.style.backgroundImage="none"}function et(t){var e=window._captureMaskCanvas,n=window._captureMaskCtx;e&&n&&(e.width=window.innerWidth,e.height=window.innerHeight,n.clearRect(0,0,e.width,e.height),n.fillStyle="rgba(0, 0, 0, 0.2)",n.fillRect(0,0,e.width,e.height),n.globalCompositeOperation="destination-out",n.fillStyle="rgba(0, 0, 0, 1)",n.fillRect(t.x,t.y,t.width,t.height),n.globalCompositeOperation="source-over",n.strokeStyle=J||"#409EFF",n.lineWidth=2,n.strokeRect(t.x+1,t.y+1,t.width-2,t.height-2))}function nt(){var t=window._markupContainer;if(t){t.innerHTML="";var e,i=o(A);try{var a=function(){var i=e.value,a=lt("div",null,{position:"absolute",left:"".concat(i.x,"px"),top:"".concat(i.y,"px"),cursor:"move",pointerEvents:"auto"});if(a.className="markup-item",a.setAttribute("draggable","false"),a.dataset.index=A.indexOf(i),a.addEventListener("mousedown",(function(t){t.stopPropagation();var e=a.getBoundingClientRect();(t.clientX<=e.left+6||t.clientX>=e.right-6||t.clientY<=e.top+6||t.clientY>=e.bottom-6)&&(C=a,k=t.clientX-a.offsetLeft,z=t.clientY-a.offsetTop,D=!0)})),"rect"===i.mode)a.style.left="".concat(i.x,"px"),a.style.top="".concat(i.y,"px"),a.style.width="".concat(i.w,"px"),a.style.height="".concat(i.h,"px"),a.style.border="".concat(i.width,"px solid ").concat(i.color),a.style.background="transparent",a.style.pointerEvents="none",a.style.boxSizing="border-box",a.style.cursor="default";else if("ellipse"===i.mode)a.style.width="".concat(i.w,"px"),a.style.height="".concat(i.h,"px"),a.style.border="".concat(i.width,"px solid ").concat(i.color),a.style.borderRadius="50%",a.style.background="transparent",a.style.pointerEvents="none",a.style.boxSizing="border-box",a.style.cursor="default";else if("text"===i.mode)a.textContent=i.text,a.style.font="".concat(i.fontWeight||"400"," ").concat(i.fontSize,"px sans-serif"),a.style.color=i.color,a.style.background="transparent",a.style.padding="2px 4px";else if("arrow"===i.mode){var c=document.createElement("canvas");c.width=window.innerWidth,c.height=window.innerHeight,c.style.cssText="\\n        position: absolute;\\n        left: 0;\\n        top: 0;\\n        pointer-events: none;\\n        z-index: 9986;\\n      ";var l=c.getContext("2d");l.strokeStyle=i.color,l.lineWidth=i.width,rt(l,i.x1,i.y1,i.x2,i.y2,i.color,i.width),t.appendChild(c)}else if("pen"===i.mode){var r=document.createElement("canvas");r.width=window.innerWidth,r.height=window.innerHeight,r.style.cssText="\\n    position: absolute;\\n    left: 0;\\n    top: 0;\\n    pointer-events: none;\\n    z-index: 9986;\\n  ";var d=r.getContext("2d");if(d.strokeStyle=i.color,d.lineWidth=i.width,d.beginPath(),i.path&&i.path.length>0){d.moveTo(i.path[0].x,i.path[0].y);for(var u=1;u<i.path.length;u++)d.lineTo(i.path[u].x,i.path[u].y)}d.stroke(),t.appendChild(r)}else if("mosaic"===i.mode){var h=document.createElement("canvas");h.width=window.innerWidth,h.height=window.innerHeight,h.style.cssText="\\n        position: absolute;\\n        left: 0;\\n        top: 0;\\n        pointer-events: none;\\n        z-index: 9986;\\n      ";var p=h.getContext("2d"),m=window._captureHiddenCtx,y=4*i.width;if(i.path&&m){var g,f=o(i.path);try{for(f.s();!(g=f.n()).done;){var w=g.value,v=Math.floor(w.x*s),b=Math.floor(w.y*s),x=n(m.getImageData(v,b,1,1).data,3),I=x[0],M=x[1],S=x[2];p.fillStyle="rgb(".concat(I,", ").concat(M,", ").concat(S,")"),p.fillRect(w.x-y/2,w.y-y/2,y,y)}}catch(t){f.e(t)}finally{f.f()}}t.appendChild(h)}t.appendChild(a)};for(i.s();!(e=i.n()).done;)a()}catch(t){i.e(t)}finally{i.f()}}}function ot(){var t=document.getElementById("undoBtn");t&&(t.disabled=0===A.length)}function it(t,e){var n=X.getBoundingClientRect(),o=t.offsetHeight||50,i=n.bottom+6,a=n.top-o-6,c=i+o>window.innerHeight?a:i,l=e.offsetLeft,r=n.left+l;t.style.left="".concat(r,"px"),t.style.top="".concat(c,"px")}function at(){var t,e=null===(t=u)||void 0===t?void 0:t.getBoundingClientRect();return e?{x:Math.round(e.left),y:Math.round(e.top),width:Math.round(e.width),height:Math.round(e.height)}:null}function ct(t,e,n,o){var i=X.offsetWidth||200,a=X.offsetHeight||40,c=t+n/2,l=e+o+10;l+a>window.innerHeight&&(l=e-a-10);var r=window.innerWidth-i-10,d=!0;c-i/2<10?(c=10,d=!1):c+i/2>window.innerWidth-10&&(c=r,d=!1),X.style.left="".concat(c,"px"),X.style.top="".concat(l,"px"),X.style.transform=d?"translateX(-50%)":"none"}function lt(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=document.createElement(t);return e&&(o.id=e),Object.assign(o.style,n),o}function rt(t,e,n,o,i,a,c){var l=10+1.5*c,r=Math.atan2(i-n,o-e),d=Math.PI/9,s=o-.5*l*Math.cos(r),u=i-.5*l*Math.sin(r);t.beginPath(),t.moveTo(e,n),t.lineTo(s,u),t.strokeStyle=a,t.lineWidth=c,t.stroke(),t.beginPath(),t.moveTo(o,i),t.lineTo(o-l*Math.cos(r-d),i-l*Math.sin(r-d)),t.lineTo(o-l*Math.cos(r+d),i-l*Math.sin(r+d)),t.closePath(),t.fillStyle=a,t.fill()}function dt(t){var e=5*t,n=document.createElement("canvas");n.width=e,n.height=e;var o=n.getContext("2d");return o.clearRect(0,0,e,e),o.beginPath(),o.arc(e/2,e/2,e/2-2,0,2*Math.PI),o.strokeStyle="rgba(0, 0, 0, 0.7)",o.lineWidth=2,o.stroke(),n.toDataURL("image/png")}function st(){var t=(window._captureTempData||{}).cropRegion,e=window._captureHiddenCanvas;if(!e||!t)return console.warn("缺少截图源或区域"),null;var i=document.createElement("canvas");i.width=t.width,i.height=t.height;var a=i.getContext("2d"),c=t.x*s,l=t.y*s,r=t.width*s,d=t.height*s;return console.log("[截图] 逻辑坐标: (".concat(t.x,", ").concat(t.y,", ").concat(t.width,"x").concat(t.height,")")),console.log("[截图] 物理坐标: (".concat(c,", ").concat(l,", ").concat(r,"x").concat(d,"), scaleFactor: ").concat(s)),a.drawImage(e,c,l,r,d,0,0,t.width,t.height),window._markupContainer&&window._markupContainer.querySelectorAll(".markup-item").forEach((function(e){var i=parseInt(e.dataset.index,10),c=A[i];if(c){var l=c.x-t.x,r=c.y-t.y;if(a.save(),"rect"===c.mode)a.strokeStyle=c.color,a.lineWidth=c.width,a.strokeRect(l,r,c.w,c.h);else if("ellipse"===c.mode)a.strokeStyle=c.color,a.lineWidth=c.width,a.beginPath(),a.ellipse(l+c.w/2,r+c.h/2,c.w/2,c.h/2,0,0,2*Math.PI),a.stroke();else if("text"===c.mode)a.font="".concat(c.fontWeight||"400"," ").concat(c.fontSize,"px sans-serif"),a.fillStyle=c.color,a.fillText(c.text,l,r+c.fontSize);else if("arrow"===c.mode)a.strokeStyle=c.color,a.lineWidth=c.width,rt(a,c.x1-t.x,c.y1-t.y,c.x2-t.x,c.y2-t.y,c.color,c.width);else if("pen"===c.mode){if(a.strokeStyle=c.color,a.lineWidth=c.width,a.beginPath(),c.path&&c.path.length>0){a.moveTo(c.path[0].x-t.x,c.path[0].y-t.y);for(var d=1;d<c.path.length;d++)a.lineTo(c.path[d].x-t.x,c.path[d].y-t.y)}a.stroke()}else if("mosaic"===c.mode){var u=window._captureHiddenCtx,h=4*c.width;if(c.path&&u){var p,m=o(c.path);try{for(m.s();!(p=m.n()).done;){var y=p.value,g=Math.floor(y.x*s),f=Math.floor(y.y*s),w=n(u.getImageData(g,f,1,1).data,3),v=w[0],b=w[1],x=w[2];a.fillStyle="rgb(".concat(v,", ").concat(b,", ").concat(x,")"),a.fillRect(y.x-t.x-h/2,y.y-t.y-h/2,h,h)}}catch(t){m.e(t)}finally{m.f()}}}a.restore()}})),i.toDataURL("image/png")}function ut(){window._captureMaskCanvas&&(window._captureMaskCanvas.remove(),window._captureMaskCanvas=null,window._captureMaskCtx=null),X.style.display="none";var t=(window._captureTempData||{}).cropRegion;if(window._captureHiddenCanvas&&t){var e=st();e&&(tt(),setTimeout((function(){p.send(m("capture-done"),e)}),0))}else console.warn("缺少截图源或区域")}function ht(){var t=G?\'<button data-action="custom" title="\'.concat(G.title,\'"><img src="\').concat(G.icon,\'" /></button>\'):"";X.innerHTML=\'\\n    <button data-action="rect" title="\'.concat(g[y].rect,\'"><img src="\').concat("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJpb25pY29uIiB2aWV3Qm94PSIwIDAgNTEyIDUxMiI+PHBhdGggZD0iTTQxNiA0NDhIOTZhMzIuMDkgMzIuMDkgMCAwMS0zMi0zMlY5NmEzMi4wOSAzMi4wOSAwIDAxMzItMzJoMzIwYTMyLjA5IDMyLjA5IDAgMDEzMiAzMnYzMjBhMzIuMDkgMzIuMDkgMCAwMS0zMiAzMnoiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMzIiLz48L3N2Zz4=",\'" /></button>\\n    <button data-action="ellipse" title="\').concat(g[y].ellipse,\'"><img src="\').concat("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJpb25pY29uIiB2aWV3Qm94PSIwIDAgNTEyIDUxMiI+PHBhdGggZD0iTTQ0OCAyNTZjMC0xMDYtODYtMTkyLTE5Mi0xOTJTNjQgMTUwIDY0IDI1NnM4NiAxOTIgMTkyIDE5MiAxOTItODYgMTkyLTE5MnoiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMzIiLz48L3N2Zz4=",\'" /></button>\\n    <button data-action="arrow" title="\').concat(g[y].arrow,\'"><img src="\').concat("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJpb25pY29uIiB2aWV3Qm94PSIwIDAgNTEyIDUxMiI+PHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI0OCIgZD0iTTExMiAyNDRsMTQ0LTE0NCAxNDQgMTQ0TTI1NiAxMjB2MjkyIi8+PC9zdmc+",\'" /></button>\\n    <button data-action="pen" title="\').concat(g[y].pen,\'"><img src="\').concat("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJpb25pY29uIiB2aWV3Qm94PSIwIDAgNTEyIDUxMiI+PHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIzMiIgZD0iTTM2NC4xMyAxMjUuMjVMODcgNDAzbC0yMyA0NSA0NC45OS0yMyAyNzcuNzYtMjc3LjEzLTIyLjYyLTIyLjYyek00MjAuNjkgNjguNjlsLTIyLjYyIDIyLjYyIDIyLjYyIDIyLjYzIDIyLjYyLTIyLjYzYTE2IDE2IDAgMDAwLTIyLjYyaDBhMTYgMTYgMCAwMC0yMi42MiAweiIvPjwvc3ZnPg==",\'" /></button>\\n    <button data-action="mosaic" title="\').concat(g[y].mosaic,\'"><img src="\').concat("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJpb25pY29uIiB2aWV3Qm94PSIwIDAgNTEyIDUxMiI+PGNpcmNsZSBjeD0iMjU2IiBjeT0iMTg0IiByPSIxMjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjMyIi8+PGNpcmNsZSBjeD0iMzQ0IiBjeT0iMzI4IiByPSIxMjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjMyIi8+PGNpcmNsZSBjeD0iMTY4IiBjeT0iMzI4IiByPSIxMjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjMyIi8+PC9zdmc+",\'" /></button>\\n    <button data-action="text" title="\').concat(g[y].text,\'"><img src="\').concat("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJpb25pY29uIiB2aWV3Qm94PSIwIDAgNTEyIDUxMiI+PHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIzMiIgZD0iTTMyIDQxNS41bDEyMC0zMjAgMTIwIDMyME0yMzAgMzAzLjVINzRNMzI2IDIzOS41YzEyLjE5LTI4LjY5IDQxLTQ4IDc0LTQ4aDBjNDYgMCA4MCAzMiA4MCA4MHYxNDQiLz48cGF0aCBkPSJNMzIwIDM1OC41YzAgMzYgMjYuODYgNTggNjAgNTggNTQgMCAxMDAtMjcgMTAwLTEwNnYtMTVjLTIwIDAtNTggMS05MiA1LTMyLjc3IDMuODYtNjggMTktNjggNTh6IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjMyIi8+PC9zdmc+",\'" /></button>\\n    <button data-action="undo" id="undoBtn" title="\').concat(g[y].undo,\'" disabled><img src="\').concat("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJpb25pY29uIiB2aWV3Qm94PSIwIDAgNTEyIDUxMiI+PHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIzMiIgZD0iTTExMiAxNjBsLTY0IDY0IDY0IDY0Ii8+PHBhdGggZD0iTTY0IDIyNGgyOTRjNTguNzYgMCAxMDYgNDkuMzMgMTA2IDEwOHYyMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIzMiIvPjwvc3ZnPg==",\'" /></button>\\n    \').concat(t,\'\\n    <button data-action="download" title="\').concat(g[y].download,\'"><img src="\').concat("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJpb25pY29uIiB2aWV3Qm94PSIwIDAgNTEyIDUxMiI+PHBhdGggZD0iTTMzNiAxNzZoNDBhNDAgNDAgMCAwMTQwIDQwdjIwOGE0MCA0MCAwIDAxLTQwIDQwSDEzNmE0MCA0MCAwIDAxLTQwLTQwVjIxNmE0MCA0MCAwIDAxNDAtNDBoNDAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMzIiLz48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjMyIiBkPSJNMTc2IDI3Mmw4MCA4MCA4MC04ME0yNTYgNDh2Mjg4Ii8+PC9zdmc+",\'" /></button>\\n    <button data-action="cancel" title="\').concat(g[y].cancel,\'" style="color: red;"><img src="\').concat("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJpb25pY29uIiB2aWV3Qm94PSIwIDAgNTEyIDUxMiI+DQogICAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmY0ZDRmIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMzIiDQogICAgICAgICAgZD0iTTQxNiA0MTZMOTYgOTZNNDE2IDk2TDk2IDQxNiIvPg0KPC9zdmc+",\'" /></button>\\n    <button data-action="confirm" title="\').concat(g[y].confirm,\'"><img src="\').concat("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj4NCiAgICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImdyZWVuIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMzIiDQogICAgICAgICAgZD0iTTQzMiAxNDRMMTc2IDQzMmwtOTYtOTYiLz4NCjwvc3ZnPg0K",\'" /></button>\\n  \')}function pt(){var t=g[y];O.innerHTML=\'\\n    <div style="display: flex; column-gap: 10px; align-items: center">\\n      <label style="margin-right: 12px;">\\n        <select id="textFontSize">\\n          <option value="14">\'.concat(t.fontSizeSmall,\'</option>\\n          <option value="18">\').concat(t.fontSizeMedium,\'</option>\\n          <option value="24">\').concat(t.fontSizeLarge,\'</option>\\n        </select>\\n      </label>\\n      <div id="colorOptions" style="display: flex; gap: 6px;">\\n        <div class="color-block" data-color="#ff4d4f" style="background: #ff4d4f;"></div>\\n        <div class="color-block" data-color="#fadb14" style="background: #fadb14;"></div>\\n        <div class="color-block" data-color="#1890ff" style="background: #1890ff;"></div>\\n        <div class="color-block" data-color="#52c41a" style="background: #52c41a;"></div>\\n        <div class="color-block" data-color="#000000" style="background: #000000;"></div>\\n      </div>\\n    </div>\\n  \'),document.getElementById("textFontSize").value=L.fontSize,document.getElementById("textFontSize").addEventListener("change",(function(t){L.fontSize=parseInt(t.target.value,10)}))}K.forEach((function(t){t.addEventListener("click",(function(){if(K.forEach((function(t){return t.classList.remove("selected")})),t.classList.add("selected"),L.lineWidth=parseInt(t.dataset.width,10),"mosaic"===E){var e=dt(L.lineWidth);document.body.style.cursor="url(".concat(e,") ").concat(2*L.lineWidth," ").concat(2*L.lineWidth,", auto"),u&&(u.style.cursor="url(".concat(e,") ").concat(2*L.lineWidth," ").concat(2*L.lineWidth,", auto"))}}))})),p.on(m("set-main-color"),(function(t,e){"string"==typeof e&&(J=e)})),p.on(m("set-lang"),(function(t,e){g[e]&&(y=e,ht(),pt())})),p.on(m("set-custom-button"),(function(t,e){G=e,ht()})),p.on(m("reset-capture-state"),(function(){if(console.log("[optimize] 快速清理状态（复用窗口）"),B&&(_&&_.clearRect(0,0,B.width,B.height),B.style.display="none"),f&&(w&&w.clearRect(0,0,f.width,f.height),f.style.display="none"),window._markupContainer&&(window._markupContainer.innerHTML="",window._markupContainer.style.display="none"),u&&(u.remove(),u=null),window._captureMaskCanvas){var t=window._captureMaskCtx;t&&t.clearRect(0,0,window._captureMaskCanvas.width,window._captureMaskCanvas.height)}I&&(I.remove(),I=null),document.body.style.backgroundImage="none",document.body.style.backgroundColor="transparent",A=[],T=[],Y=!1,Z=!1,H=!1,D=!1,N=!1,E=null,C=null,c=l=r=d=0,b=!1,X.style.display="none",$(),U&&(U.style.display="none"),console.log("[optimize] ✅ 状态清理完成")})),p.on(m("set-window-index"),(function(t,e){V=e})),p.on(m("set-crop-limit"),(function(t,e){window._captureTempData=window._captureTempData||{},window._captureTempData.cropRegionLimit=e})),p.on(m("highlight-border"),(function(t,e){V===e?(Q.style.border="2px solid ".concat(J),Q.style.background="rgba(0, 0, 0, 0.2)",U&&!Z&&(U.style.display="block")):(Q.style.border="none",Q.style.background="rgba(0, 0, 0, 0.4)",U&&(U.style.display="none"))})),p.on(m("screenshot-lock-state"),(function(t,e){var n=e.locked,o=e.isSelf;x=n&&!o})),p.on(m("display-screenshot"),(function(t,e,n,o){console.log("[optimize] 接收截图数据"),B&&(B.remove(),B=null,_=null),f&&(f.remove(),f=null,w=null),window._markupContainer&&(window._markupContainer.remove(),window._markupContainer=null),s=n,h=o,window._screenshotImage?console.log("[optimize] 复用 Image 对象"):(console.log("[optimize] 创建 Image 对象（首次）"),window._screenshotImage=new Image);var i=window._screenshotImage;u&&(document.body.removeChild(u),u=null),X.style.display="none",$(),c=l=r=d=0;var a=!1,y=function(){if(!a){a=!0,console.log("[optimize] 图片加载完成，设置背景"),document.body.style.backgroundImage="url(".concat(e,")"),document.body.style.backgroundSize="cover",document.body.style.userSelect="none",document.body.style.backgroundColor="transparent";var t=document.createElement("canvas");t.width=i.width,t.height=i.height;var n=t.getContext("2d");n.imageSmoothingEnabled=!1,n.webkitImageSmoothingEnabled=!1,n.mozImageSmoothingEnabled=!1,n.msImageSmoothingEnabled=!1,n.drawImage(i,0,0),window._captureHiddenCanvas=t,window._captureHiddenCtx=n;var o=lt("canvas","maskCanvas",{position:"fixed",left:"0",top:"0",pointerEvents:"none",zIndex:9980,backgroundColor:"transparent"});document.body.appendChild(o),window._captureMaskCanvas=o,window._captureMaskCtx=o.getContext("2d"),U.style.display="block",p.send(m("screenshot-background-ready")),setTimeout((function(){b=!0,console.log("[capture] 窗口交互已就绪")}),100)}};i.onload=y,i.src=e,i.complete&&i.naturalWidth>0&&y()})),document.addEventListener("mousedown",(function(t){var e,n,i;if(v&&0===t.button)if(b){p.send(m("user-interaction-start"));var a,s=o(document.querySelectorAll(".markup-item"));try{for(s.s();!(a=s.n()).done;){var h=a.value,y=h.getBoundingClientRect();if(t.clientX>=y.left&&t.clientX<=y.right&&t.clientY>=y.top&&t.clientY<=y.bottom&&(Math.abs(t.clientX-y.left)<=6||Math.abs(t.clientX-y.right)<=6||Math.abs(t.clientY-y.top)<=6||Math.abs(t.clientY-y.bottom)<=6))return C=h,k=t.clientX-h.offsetLeft,z=t.clientY-h.offsetTop,D=!0,void t.preventDefault()}}catch(t){s.e(t)}finally{s.f()}if(t.target.classList.contains("markup-item"))return C=t.target,k=t.clientX-C.offsetLeft,z=t.clientY-C.offsetTop,D=!0,void t.preventDefault();var g=null===(e=u)||void 0===e||null===(n=e.getBoundingClientRect)||void 0===n?void 0:n.call(e),f=g&&t.clientX>=g.left&&t.clientX<=g.right&&t.clientY>=g.top&&t.clientY<=g.bottom;if(Z&&f&&!E&&0===A.length&&0===t.button)return N=!0,W=t.clientX-g.left,void(P=t.clientY-g.top);if(!t.target.closest("#screenshot-editor-toolbar")&&!t.target.closest("#text-config-panel")&&!(I&&I.contains(t.target)||D)){var w=null===(i=window._captureTempData)||void 0===i?void 0:i.cropRegion,M=t.clientX,S=t.clientY;if("text"===E&&Z&&0===t.button){if(!(M>=w.x&&M<=w.x+w.width&&S>=w.y&&S<=w.y+w.height))return;var B=L.fontSize,G=L.strokeColor,O=lt("input",null,{position:"fixed",left:"".concat(M,"px"),top:"".concat(S,"px"),zIndex:99999,border:"1px solid red",backgroundColor:"transparent",outline:"none",padding:"2px 4px",borderRadius:"4px",caretColor:G,fontWeight:"bold",font:"".concat(L.fontWeight||"400"," ").concat(B,"px sans-serif"),color:G});return O.type="text",document.body.appendChild(O),setTimeout((function(){O.focus()}),0),I=O,O.addEventListener("keydown",(function(t){if("Enter"===t.key){var e=O.value.trim();if(""!==e){var n={mode:"text",x:parseInt(O.style.left,10),y:parseInt(O.style.top,10),text:e,color:O.style.color,fontSize:B,fontWeight:L.fontWeight||"400"};A.push(n),ot(),T.push(JSON.parse(JSON.stringify(A))),_.font="".concat(n.fontWeight||"400"," ").concat(n.fontSize,"px sans-serif"),_.fillStyle=n.color,nt()}O.remove(),I=null}})),void O.addEventListener("blur",(function(){if(!O.value.trim())return O.remove(),void(I=null);var t=O.value.trim(),e={mode:"text",x:parseInt(O.style.left,10),y:parseInt(O.style.top,10),text:t,color:O.style.color,fontSize:L.fontSize,fontWeight:L.fontWeight||"400"};A.push(e),ot(),T.push(JSON.parse(JSON.stringify(A))),_.font="".concat(e.fontWeight||"400"," ").concat(e.fontSize,"px sans-serif"),_.fillStyle=e.color,nt(),O.remove(),I=null}))}if(["rect","ellipse","arrow","pen","mosaic"].includes(E)&&Z){var Q,V=null===(Q=window._captureTempData)||void 0===Q?void 0:Q.cropRegion;if(M>=V.x&&M<=V.x+V.width&&S>=V.y&&S<=V.y+V.height){H=!0;var U=L.lineWidth/2;R=M+U,j=S+U,"pen"!==E&&"mosaic"!==E||(window._currentPenPath=[{x:M,y:S}])}}else if(!Z||0!==t.button){if(x&&0===t.button)return t.preventDefault(),void t.stopPropagation();if(E&&Z){var F,q=null===(F=window._captureTempData)||void 0===F?void 0:F.cropRegion;t.clientX>=q.x&&t.clientX<=q.x+q.width&&t.clientY>=q.y&&t.clientY<=q.y+q.height&&(H=!0,R=t.clientX,j=t.clientY)}else{if(!window._captureMaskCanvas){var K=lt("canvas","maskCanvas",{position:"fixed",left:"0",top:"0",pointerEvents:"none",zIndex:9980,backgroundColor:"transparent"});document.body.appendChild(K),window._captureMaskCanvas=K,window._captureMaskCtx=K.getContext("2d")}var tt;u&&(document.body.removeChild(u),u=null),0===t.button&&(X.style.display="none",$()),0===t.button&&(Y=!0,c=t.clientX,l=t.clientY,r=t.clientX,d=t.clientY,tt=l,u=lt("div","selectionBox",{position:"absolute",left:"".concat(c,"px"),top:"".concat(tt,"px"),border:"2px solid ".concat(J),background:"rgba(255, 255, 255, 0)",zIndex:9982,boxSizing:"border-box",pointerEvents:"none",width:"1px",height:"1px"}),document.body.appendChild(u))}}}}else console.warn("[capture] 窗口尚未准备好接收交互，忽略 mousedown")})),window.addEventListener("mousemove",(function(t){var e;if(v){var i,a=!1,h=o(document.querySelectorAll(".markup-item"));try{for(h.s();!(i=h.n()).done;){var y=i.value.getBoundingClientRect();if(t.clientX>=y.left&&t.clientX<=y.right&&t.clientY>=y.top&&t.clientY<=y.bottom&&(Math.abs(t.clientX-y.left)<=6||Math.abs(t.clientX-y.right)<=6||Math.abs(t.clientY-y.top)<=6||Math.abs(t.clientY-y.bottom)<=6)){document.body.style.cursor="move",a=!0;break}}}catch(t){h.e(t)}finally{h.f()}if(a||"mosaic"===E||(document.body.style.cursor="default"),C){var g,b=null===(g=window._captureTempData)||void 0===g?void 0:g.cropRegion;if(!b)return;var x=t.clientX-k,I=t.clientY-z,D=C.offsetWidth,T=C.offsetHeight;return x=Math.max(b.x,Math.min(b.x+b.width-D,x)),I=Math.max(b.y,Math.min(b.y+b.height-T,I)),C.style.left="".concat(x,"px"),void(C.style.top="".concat(I,"px"))}if(Z&&u&&(t.target.classList.contains("markup-item")?u.style.cursor="default":!E&&0===A.length&&u.contains(t.target)?u.style.cursor="move":u.style.cursor="default"),N&&u){var B,_=(null===(B=window._captureTempData)||void 0===B?void 0:B.cropRegionLimit)||{x:0,y:0,width:window.innerWidth,height:window.innerHeight},G=u.offsetWidth,X=u.offsetHeight,O=t.clientX-W,Q=t.clientY-P;O=Math.max(_.x,Math.min(_.x+_.width-G,O)),Q=Math.max(_.y,Math.min(_.y+_.height-X,Q)),u.style.left="".concat(O,"px"),u.style.top="".concat(Q,"px"),u.style.opacity="0.8",u.style.boxShadow="0 0 0 1px rgba(0,0,0,0.15)",window._captureTempData.cropRegion={x:O,y:Q,width:G,height:X},et(window._captureTempData.cropRegion),ct(O,Q,G,X)}var V={x:t.screenX,y:t.screenY};p.send(m("check-display"),V);var q=window._captureHiddenCanvas,K=window._captureHiddenCtx;if(M=t.clientX,S=t.clientY,q&&K){var $=50,tt=150;U.width=tt,U.height=190,U.style.width="".concat(U.width,"px"),U.style.height="".concat(U.height,"px");var nt=Math.floor(t.clientX),ot=Math.floor(t.clientY),it=Math.floor(nt*s),lt=Math.floor(ot*s),dt=K.getImageData(it-25,lt-25,$,$),st=document.createElement("canvas");st.width=$,st.height=$,st.getContext("2d").putImageData(dt,0,0),F.clearRect(0,0,U.width,U.height),F.imageSmoothingEnabled=!1,F.drawImage(st,0,0,$,$,0,0,tt,tt),F.strokeStyle=J,F.lineWidth=1,F.strokeRect(0,0,tt,tt),F.beginPath(),F.moveTo(75,0),F.lineTo(75,tt),F.moveTo(0,75),F.lineTo(tt,75),F.strokeStyle=J,F.stroke();var ut=window.innerWidth,ht=window.innerHeight,pt=t.clientX+20,mt=t.clientY+20;pt+U.width>ut&&(pt=t.clientX-U.width-20),mt+U.height>ht&&(mt=t.clientY-U.height-20),U.style.left="".concat(pt,"px"),U.style.top="".concat(mt,"px");var yt=function(t,e,o){var i=t.canvas;if(e<0||o<0||e>=i.width||o>=i.height)return{r:0,g:0,b:0,rgb:"rgb(0, 0, 0)",hex:"#000000"};var a=n(t.getImageData(e,o,1,1).data,3),c=a[0],l=a[1],r=a[2],d=function(t){return t>=253?255:t};c=d(c),l=d(l),r=d(r);var s=function(t){return t.toString(16).padStart(2,"0")},u="#".concat(s(c)).concat(s(l)).concat(s(r));return{r:c,g:l,b:r,rgb:"rgb(".concat(c,", ").concat(l,", ").concat(r,")"),hex:u}}(K,it,lt),gt=yt.r,ft=yt.g,wt=yt.b;F.font="14px sans-serif";var vt="x: ".concat(nt,", y: ").concat(ot),bt="rgb(".concat(gt,", ").concat(ft,", ").concat(wt,")"),xt=F.measureText(vt).width,It=F.measureText(bt).width;F.fillStyle="#000",F.fillRect(0,152,xt+8,16),F.fillStyle="#fff",F.fillText(vt,4,164),F.fillStyle="#000",F.fillRect(0,170,It+8,16),F.fillStyle="#fff",F.fillText(bt,4,182)}if(H&&E&&w){var Mt,St=null===(Mt=window._captureTempData)||void 0===Mt?void 0:Mt.cropRegion,Ct=Math.min(Math.max(M,St.x),St.x+St.width),kt=Math.min(Math.max(S,St.y),St.y+St.height),zt=Math.min(R,Ct),Dt=Math.min(j,kt),Tt=Math.abs(Ct-R),Nt=Math.abs(kt-j);if(w.clearRect(0,0,f.width,f.height),w.strokeStyle=L.strokeColor,w.lineWidth=L.lineWidth,"rect"===E)w.strokeRect(zt,Dt,Tt,Nt);else if("ellipse"===E)w.beginPath(),w.ellipse(zt+Tt/2,Dt+Nt/2,Tt/2,Nt/2,0,0,2*Math.PI),w.stroke();else if("arrow"===E)rt(w,R,j,Ct,kt,L.strokeColor,L.lineWidth);else if("pen"===E){var Wt,Pt=null===(Wt=window._captureTempData)||void 0===Wt?void 0:Wt.cropRegion,At=Math.min(Math.max(M,Pt.x),Pt.x+Pt.width),Lt=Math.min(Math.max(S,Pt.y),Pt.y+Pt.height);window._currentPenPath.push({x:At,y:Lt}),w.clearRect(0,0,f.width,f.height),w.strokeStyle=L.strokeColor,w.lineWidth=L.lineWidth,w.beginPath();var Yt=window._currentPenPath;w.moveTo(Yt[0].x,Yt[0].y);for(var Zt=1;Zt<Yt.length;Zt++)w.lineTo(Yt[Zt].x,Yt[Zt].y);w.stroke()}else if("mosaic"===E){for(var Et,Ht=null===(Et=window._captureTempData)||void 0===Et?void 0:Et.cropRegion,Rt=Math.min(Math.max(M,Ht.x),Ht.x+Ht.width),jt=Math.min(Math.max(S,Ht.y),Ht.y+Ht.height),Bt=window._currentPenPath[window._currentPenPath.length-1],_t=Rt-Bt.x,Jt=jt-Bt.y,Gt=Math.sqrt(_t*_t+Jt*Jt),Xt=2*L.lineWidth,Ot=Math.floor(Gt/Xt),Qt=1;Qt<=Ot;Qt++){var Vt=Bt.x+_t*Qt/Ot,Ut=Bt.y+Jt*Qt/Ot;window._currentPenPath.push({x:Vt,y:Ut})}window._currentPenPath.push({x:Rt,y:jt}),w.clearRect(0,0,f.width,f.height);var Ft=4*L.lineWidth,qt=window._captureHiddenCtx;if(!qt)return;var Kt,$t=o(window._currentPenPath);try{for($t.s();!(Kt=$t.n()).done;){var te=Kt.value,ee=Math.floor(te.x*s),ne=Math.floor(te.y*s),oe=n(qt.getImageData(ee,ne,1,1).data,3),ie=oe[0],ae=oe[1],ce=oe[2];w.fillStyle="rgb(".concat(ie,", ").concat(ae,", ").concat(ce,")"),w.fillRect(te.x-Ft/2,te.y-Ft/2,Ft,Ft)}}catch(t){$t.e(t)}finally{$t.f()}}}if(Y&&1===t.buttons){var le=(null===(e=window._captureTempData)||void 0===e?void 0:e.cropRegionLimit)||{x:0,y:0,width:window.innerWidth,height:window.innerHeight};r=Math.min(Math.max(t.clientX,le.x),le.x+le.width),d=Math.min(Math.max(t.clientY,le.y),le.y+le.height);var re=Math.min(c,r),de=Math.min(l,d),se=Math.abs(r-c),ue=Math.abs(d-l);u.style.left="".concat(re,"px"),u.style.top="".concat(de,"px"),u.style.width="".concat(se,"px"),u.style.height="".concat(ue,"px"),et(at())}}})),window.addEventListener("mouseup",(function(t){if(v&&0===t.button){if(p.send(m("user-interaction-end")),N=!1,C){var e=parseInt(C.dataset.index,10);isNaN(e)||(A[e].x=parseInt(C.style.left,10),A[e].y=parseInt(C.style.top,10)),C=null,D=!1,T.push(JSON.parse(JSON.stringify(A))),ot()}if(H){var n;H=!1;var o=null===(n=window._captureTempData)||void 0===n?void 0:n.cropRegion,i=L.lineWidth/2,a=Math.min(Math.max(t.clientX,o.x+1),o.x+o.width-1),s=Math.min(Math.max(t.clientY,o.y+1),o.y+o.height-1),y=Math.min(R,a)-i,g=Math.min(j,s)-i,b=Math.abs(a-R)+2*i,x=Math.abs(s-j)+2*i;return"pen"===E?(A.push({mode:"pen",path:window._currentPenPath||[],color:L.strokeColor,width:L.lineWidth}),window._currentPenPath=null):"arrow"===E?A.push({mode:"arrow",x1:R,y1:j,x2:a,y2:s,color:L.strokeColor,width:L.lineWidth}):"mosaic"===E?(A.push({mode:"mosaic",path:window._currentPenPath||[],width:L.lineWidth}),window._currentPenPath=null):A.push({mode:E,x:y,y:g,w:b,h:x,color:L.strokeColor,width:L.lineWidth}),ot(),nt(),w&&w.clearRect(0,0,f.width,f.height),T.push(JSON.parse(JSON.stringify(A))),void ot()}if(Y){Y=!1,U.style.display="none";var I=at();if(c===r&&l===d);else{window._captureTempData={cropRegion:I,thumbnailSize:h,currentWindowIndex:V};var M=Math.min(c,r),S=Math.min(l,d),k=Math.abs(r-c),z=Math.abs(d-l);if(!B){(B=lt("canvas",null,{position:"fixed",left:"0",top:"0",pointerEvents:"none",zIndex:9985})).id="markupCanvas",B.width=window.innerWidth,B.height=window.innerHeight,document.body.appendChild(B),_=B.getContext("2d");var W=document.createElement("div");W.id="markup-container",W.style.cssText="\\n        position: fixed;\\n        left: 0;\\n        top: 0;\\n        width: 100%;\\n        height: 100%;\\n        z-index: 9986;\\n        pointer-events: none;\\n      ",document.body.appendChild(W),window._markupContainer=W,f||((f=lt("canvas","previewCanvas",{position:"fixed",left:"0",top:"0",pointerEvents:"none",zIndex:9986})).width=window.innerWidth,f.height=window.innerHeight,document.body.appendChild(f),w=f.getContext("2d"))}X.style.display="block",ct(M,S,k,z),Z=!0,u.style.opacity="",u.style.boxShadow="",p.send(m("force-window-top")),p.send(m("screenshot-window-lock"),V)}}}})),document.addEventListener("contextmenu",(function(t){if(t.preventDefault(),Z){if(A.length>0)return;if(E)return;return Z=!1,u&&(u.remove(),u=null),window._captureMaskCanvas&&(window._captureMaskCanvas.remove(),window._captureMaskCanvas=null,window._captureMaskCtx=null),_&&_.clearRect(0,0,B.width,B.height),X.style.display="none",$(),U.style.display="block",void p.send(m("screenshot-window-unlock"))}tt()})),document.addEventListener("keydown",(function(t){"Escape"===t.key&&tt()})),X.addEventListener("click",(function(t){var e=t.target.closest("button[data-action]");if(e){p.send(m("force-window-top"));var n=e.dataset.action;if("cancel"===n&&tt(),"confirm"===n&&ut(),"text"===n){var o=document.getElementById("text-config-panel");if("text"===E)E=null,o.style.display="none",nt();else{E="text",$(),it(o,e),o.style.display="block";var i=o.querySelectorAll(".color-block");i.forEach((function(t){t.addEventListener("click",(function(){i.forEach((function(t){return t.classList.remove("selected")})),t.classList.add("selected"),L.strokeColor=t.dataset.color}))})),u&&(u.style.cursor="default"),document.getElementById("textFontSize").value=L.fontSize,document.getElementById("textFontSize").addEventListener("change",(function(t){L.fontSize=parseInt(t.target.value,10)}))}}if(["rect","ellipse","arrow","pen","mosaic"].includes(n))if(document.getElementById("text-config-panel").style.display="none",E===n)E=null,$(),nt();else if(E=n,function(t){var e=document.getElementById("draw-config-panel");it(e,t),e.style.display="block";var n=document.getElementById("colorOptions");n&&(n.style.display="mosaic"===E?"none":"flex"),document.querySelectorAll("#colorOptions .color-block").forEach((function(t){t.classList.toggle("selected",t.dataset.color.toLowerCase()===L.strokeColor.toLowerCase())})),document.querySelectorAll("#lineWidthOptions .line-dot").forEach((function(t){t.classList.toggle("selected",parseInt(t.dataset.width)===L.lineWidth)}))}(e),"mosaic"===E){var a=dt(L.lineWidth);document.body.style.cursor="url(".concat(a,") ").concat(2*L.lineWidth," ").concat(2*L.lineWidth,", auto"),u&&(u.style.cursor="url(".concat(a,") ").concat(2*L.lineWidth," ").concat(2*L.lineWidth,", auto"))}else document.body.style.cursor="default",u&&(u.style.cursor="default");if("undo"===n&&T.length>0){T.pop();var c=T[T.length-1]||[];A=JSON.parse(JSON.stringify(c)),nt(),ot()}if("download"===n){var l=st();l&&p.invoke(m("save-capture-image"),{base64Data:l,windowIndex:V}).then((function(t){t?tt():console.log("用户取消保存，保持截图状态")}))}if("custom"===n){var r=st();r&&p.send(m("custom-button-click"),r)}}})),document.addEventListener("dblclick",(function(t){var e;if(v&&b&&Z){var n=null===(e=window._captureTempData)||void 0===e?void 0:e.cropRegion;if(n){var o=t.clientX,i=t.clientY;o>=n.x&&o<=n.x+n.width&&i>=n.y&&i<=n.y+n.height&&(p.send(m("force-window-top")),ut())}}})),CaptureApp={}})();<\/script></body>\r\n</html>\r\n'},781:(t,e,n)=>{function o(){"use strict";o=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},c=r.iterator||"@@iterator",l=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function d(t,e,n,o){return Object.defineProperty(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o})}try{d({},"")}catch(t){d=function(t,e,n){return t[e]=n}}function u(e,n,o,i){var r=n&&n.prototype instanceof f?n:f,a=Object.create(r.prototype);return d(a,"_invoke",function(e,n,o){var i=1;return function(r,a){if(3===i)throw Error("Generator is already running");if(4===i){if("throw"===r)throw a;return{value:t,done:!0}}for(o.method=r,o.arg=a;;){var c=o.delegate;if(c){var l=M(c,o);if(l){if(l===h)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(1===i)throw i=4,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);i=3;var s=p(e,n,o);if("normal"===s.type){if(i=o.done?4:2,s.arg===h)continue;return{value:s.arg,done:o.done}}"throw"===s.type&&(i=4,o.method="throw",o.arg=s.arg)}}}(e,o,new C(i||[])),!0),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var h={};function f(){}function g(){}function y(){}var m={};d(m,c,(function(){return this}));var v=Object.getPrototypeOf,w=v&&v(v(D([])));w&&w!==n&&i.call(w,c)&&(m=w);var b=y.prototype=f.prototype=Object.create(m);function x(t){["next","throw","return"].forEach((function(e){d(t,e,(function(t){return this._invoke(e,t)}))}))}function I(t,e){function n(o,r,c,l){var s=p(t[o],t,r);if("throw"!==s.type){var d=s.arg,u=d.value;return u&&"object"==a(u)&&i.call(u,"__await")?e.resolve(u.__await).then((function(t){n("next",t,c,l)}),(function(t){n("throw",t,c,l)})):e.resolve(u).then((function(t){d.value=t,c(d)}),(function(t){return n("throw",t,c,l)}))}l(s.arg)}var o;d(this,"_invoke",(function(t,i){function r(){return new e((function(e,o){n(t,i,e,o)}))}return o=o?o.then(r,r):r()}),!0)}function M(e,n){var o=n.method,i=e.i[o];if(i===t)return n.delegate=null,"throw"===o&&e.i.return&&(n.method="return",n.arg=t,M(e,n),"throw"===n.method)||"return"!==o&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+o+"' method")),h;var r=p(i,e.i,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,h;var a=r.arg;return a?a.done?(n[e.r]=a.value,n.next=e.n,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,h):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function k(t){this.tryEntries.push(t)}function S(e){var n=e[4]||{};n.type="normal",n.arg=t,e[4]=n}function C(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function D(e){if(null!=e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,r=function n(){for(;++o<e.length;)if(i.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return r.next=r}}throw new TypeError(a(e)+" is not iterable")}return g.prototype=y,d(b,"constructor",y),d(y,"constructor",g),g.displayName=d(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,d(t,s,"GeneratorFunction")),t.prototype=Object.create(b),t},e.awrap=function(t){return{__await:t}},x(I.prototype),d(I.prototype,l,(function(){return this})),e.AsyncIterator=I,e.async=function(t,n,o,i,r){void 0===r&&(r=Promise);var a=new I(u(t,n,o,i),r);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(b),d(b,s,"Generator"),d(b,c,(function(){return this})),d(b,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var o in e)n.unshift(o);return function t(){for(;n.length;)if((o=n.pop())in e)return t.value=o,t.done=!1,t;return t.done=!0,t}},e.values=D,C.prototype={constructor:C,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(t){a.type="throw",a.arg=e,n.next=t}for(var i=n.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],a=r[4],c=this.prev,l=r[1],s=r[2];if(-1===r[0])return o("end"),!1;if(!l&&!s)throw Error("try statement without catch or finally");if(null!=r[0]&&r[0]<=c){if(c<l)return this.method="next",this.arg=t,o(l),!0;if(c<s)return o(s),!1}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o[0]>-1&&o[0]<=this.prev&&this.prev<o[2]){var i=o;break}}i&&("break"===t||"continue"===t)&&i[0]<=e&&e<=i[2]&&(i=null);var r=i?i[4]:{};return r.type=t,r.arg=e,i?(this.method="next",this.next=i[2],h):this.complete(r)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n[2]===t)return this.complete(n[4],n[3]),S(n),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n[0]===t){var o=n[4];if("throw"===o.type){var i=o.arg;S(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,o){return this.delegate={i:D(e),r:n,n:o},"next"===this.method&&(this.arg=t),h}},e}function i(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return r(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function c(t,e,n,o,i,r,a){try{var c=t[r](a),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(o,i)}function l(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var r=t.apply(e,n);function a(t){c(r,o,i,a,l,"next",t)}function l(t){c(r,o,i,a,l,"throw",t)}a(void 0)}))}}function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){u(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function u(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=a(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==a(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n(928);var p=n(896),h=n(857),f=n(789),g=function(t){return"screenshot-plugin/".concat(t)};function y(){var t=h.platform(),e=h.release();return"win32"===t&&e.startsWith("6.1")}var m=[];function v(t,e){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"zh",i=t.screen,r=t.BrowserWindow;try{if(!(n=i.getAllDisplays())||0===n.length)throw new Error("No displays found");console.log("[screenshot-plugin] Found ".concat(n.length," displays, Win7: ").concat(y()))}catch(t){throw console.error("[screenshot-plugin] Failed to get displays:",t.message),t}return n.forEach((function(t,n){try{var i=t.bounds,a=i.width,c=i.height,l=i.x,s=i.y;console.log("[screenshot-plugin] Creating window for display ".concat(n,": ").concat(a,"x").concat(c," at (").concat(l,",").concat(s,")"));var u=(h=y(),d(d({},{frame:!1,fullscreen:!1,alwaysOnTop:!0,resizable:!1,movable:!1,skipTaskbar:!0,focusable:!0,webPreferences:{webSecurity:!1,nodeIntegration:!0,contextIsolation:!1}}),{},h?{transparent:!1,backgroundColor:"#000000",opacity:.01}:{transparent:!0}));u.width=a,u.height=c,u.x=l,u.y=s;var p=new r(u);p.setBounds({x:l,y:s,width:a,height:c});try{y()?p.setAlwaysOnTop(!0):p.setAlwaysOnTop(!0,"screen-saver")}catch(t){console.warn("[screenshot-plugin] setAlwaysOnTop failed, fallback to basic:",t.message),p.setAlwaysOnTop(!0)}p._captureLang=o,p.captureWindowIndex=t.id,p.loadURL(e),p.hide(),p.on("close",(function(t){t.preventDefault(),p.hide()})),m.push(p)}catch(t){console.error("[screenshot-plugin] Failed to create window for display ".concat(n,":"),t.message)}var h})),m}var w=n(641),b=Buffer.from(w,"utf-8").toString("base64"),x="data:text/html;base64,".concat(b);function I(){return I=l(o().mark((function t(e){var n,r,c,s,u,h,w,b,I,M,k;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:c=e.electron,s=c.ipcMain,u=c.screen,c.desktopCapturer,h=c.BrowserWindow,w=c.dialog,console.log("[screenshot-plugin] screenshot-desktop 模块状态:",a(f)),"function"!=typeof f?console.error("[screenshot-plugin] ❌ screenshot-desktop 加载失败！"):console.log("[screenshot-plugin] ✅ screenshot-desktop 加载成功"),y()&&(null===(b=e.logger)||void 0===b||b.call(e,"[screenshot-plugin] ⚠️ Windows 7 detected - using compatibility mode"),console.warn("[screenshot-plugin] Running in Windows 7 compatibility mode. Some features may be limited.")),I=!1,M=!1,k=function(){var t,n;I||(v(e.electron,x,(null===(t=e.config)||void 0===t?void 0:t.lang)||"zh"),null===(n=e.logger)||void 0===n||n.call(e,"[plugin] window created"),I=!0)},e.ipc.registerCommand("screenshot.prepareWindows",k),e.exports={prepareCaptureWindow:k,onCaptureDone:void 0,onCaptureCancel:void 0},null===(n=e.logger)||void 0===n||n.call(e,"[screenshot-plugin] begin register ipc"),s.on(g("capture-window-ready"),(function(t){var n=h.fromWebContents(t.sender),o=m.findIndex((function(t){return t===n}));if(-1!==o){var i,r,a=u.getAllDisplays()[o];n.webContents.send(g("set-window-index"),a.id),n.webContents.send(g("set-main-color"),(null===(i=e.config)||void 0===i?void 0:i.color)||"#07c160"),null!==(r=e.config)&&void 0!==r&&r.customButton&&n.webContents.send(g("set-custom-button"),{icon:e.config.customButton.icon,title:e.config.customButton.title||"自定义"})}})),s.on(g("screenshot-window-lock"),(function(t,e){m.forEach((function(t,n){var o=n===e;t.webContents.send(g("screenshot-lock-state"),{locked:!0,isSelf:o})}))})),s.on(g("screenshot-window-unlock"),(function(){m.forEach((function(t){t.webContents.send(g("screenshot-lock-state"),{locked:!1,isSelf:!1})}))})),s.on(g("request-capture"),function(){var t=l(o().mark((function t(n,r){var c,s,p,h,v,w,b,I,k,S,C,D,T;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(T=function(){return T=l(o().mark((function t(n,i){var r,a,c,l,s,d,u,p,h=arguments;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=h.length>2&&void 0!==h[2]?h[2]:3,a=0;case 2:if(!(a<r)){t.next=34;break}if(t.prev=3,c=Date.now(),!(y()&&a>0)){t.next=8;break}return t.next=8,new Promise((function(t){return setTimeout(t,300)}));case 8:if(l=void 0,!(s=I.get(i))){t.next=17;break}return console.log("[screenshot-plugin] 开始截取 Electron索引=".concat(i,", display.id=").concat(n.id,", 使用 screenshot-desktop.id=").concat(s,"，尝试 ").concat(a+1,"/").concat(r)),t.next=14,f({screen:s,format:"jpg"});case 14:l=t.sent,t.next=21;break;case 17:return console.log("[screenshot-plugin] 无映射ID，使用索引 ".concat(i,"，尝试 ").concat(a+1,"/").concat(r)),t.next=20,f({screen:i,format:"jpg"});case 20:l=t.sent;case 21:return d="data:image/jpeg;base64,".concat(l.toString("base64")),console.log("[screenshot-plugin] 截图完成，Electron索引=".concat(i,"，耗时: ").concat(Date.now()-c,"ms，大小: ").concat((l.length/1024).toFixed(2)," KB")),t.abrupt("return",d);case 26:t.prev=26,t.t0=t.catch(3),t.t0,null===(u=e.logger)||void 0===u||u.call(e,"[screenshot-plugin] Screenshot attempt ".concat(a+1," failed: ").concat(t.t0.message)),a===r-1&&(null===(p=e.logger)||void 0===p||p.call(e,"[screenshot-plugin] All screenshot attempts failed for display ".concat(n.id)));case 31:a++,t.next=2;break;case 34:return t.abrupt("return",null);case 35:case"end":return t.stop()}}),t,null,[[3,26]])}))),T.apply(this,arguments)},D=function(t,e){return T.apply(this,arguments)},console.log("[screenshot-plugin] request-capture 收到请求，options:",a(r),null!=r&&r.customButton?"有customButton":"无customButton"),!M){t.next=6;break}return console.log("[screenshot-plugin] 截图进行中，忽略重复请求"),t.abrupt("return");case 6:return M=!0,console.log("[screenshot-plugin] 开始截图流程"),c="object"===a(r)&&null!==r?r:{screenId:r,customButton:void 0},c.screenId,void 0!==(s=c.customButton)&&(console.log("[screenshot-plugin] 设置自定义按钮，title:",null==s?void 0:s.title),e.config&&(e.config.customButton=s,console.log("[screenshot-plugin] 主进程配置已更新")),p=null===s?null:{icon:s.icon,title:s.title},m.forEach((function(t){t&&!t.isDestroyed()&&t.webContents.send(g("set-custom-button"),p)}))),h=u.getAllDisplays(),v=u.getPrimaryDisplay(),console.log("[screenshot-plugin] Electron 显示器详细信息:"),h.forEach((function(t,e){var n=t.id===v.id;console.log("  [".concat(e,"] id=").concat(t.id,", bounds=").concat(JSON.stringify(t.bounds),", ")+"scaleFactor=".concat(t.scaleFactor,", rotation=").concat(t.rotation,", ")+"internal=".concat(t.internal,', label="').concat(t.label,'", ')+"主屏=".concat(n))})),t.prev=14,t.next=17,f.listDisplays();case 17:w=t.sent,console.log("[screenshot-plugin] screenshot-desktop 显示器列表:"),w.forEach((function(t,e){console.log("  [".concat(e,"] id=").concat(t.id,", name=").concat(t.name))})),t.next=27;break;case 22:t.prev=22,t.t0=t.catch(14),console.error("[screenshot-plugin] 无法获取 screenshot-desktop 显示器列表:",t.t0.message),null===(b=e.logger)||void 0===b||b.call(e,"[screenshot-plugin] listDisplays() 不支持或失败，使用备用方案"),w=null;case 27:return I=new Map,w&&w.length===h.length&&(console.log("[screenshot-plugin] 开始匹配显示器（通用算法）..."),k=h.findIndex((function(t){return t.id===v.id})),console.log("[screenshot-plugin] 主显示器在 Electron 索引 ".concat(k)),S=i(h).map((function(t,e){return d(d({},t),{},{originalIndex:e,isPrimary:t.id===v.id})})).sort((function(t,e){return t.bounds.x-e.bounds.x})),console.log("[screenshot-plugin] 排序后的 Electron 显示器:"),S.forEach((function(t,e){console.log("  [".concat(e,"] 原始索引=").concat(t.originalIndex,", x=").concat(t.bounds.x,", 主屏=").concat(t.isPrimary))})),C=i(w).sort((function(t,e){var n,o;return parseInt((null===(n=t.id.match(/DISPLAY(\d+)/))||void 0===n?void 0:n[1])||"999")-parseInt((null===(o=e.id.match(/DISPLAY(\d+)/))||void 0===o?void 0:o[1])||"999")})),console.log("[screenshot-plugin] 排序后的 screenshot-desktop 显示器:"),C.forEach((function(t,e){console.log("  [".concat(e,"] id=").concat(t.id))})),S.forEach((function(t,e){C[e]&&(I.set(t.originalIndex,C[e].id),console.log("[screenshot-plugin] 映射：Electron索引 ".concat(t.originalIndex," ")+"(x=".concat(t.bounds.x,", 主屏=").concat(t.isPrimary,") ")+"-> ".concat(C[e].id)))}))),t.next=31,Promise.all(h.map((function(t,e){return D(t,e)})));case 31:t.sent.forEach((function(t,n){var o,i=m[n],r=h[n].scaleFactor;t&&i&&(i._isPageLoaded?(null===(o=e.logger)||void 0===o||o.call(e,"[screenshot-plugin] Window ".concat(n," reusing (reload for clean state)")),i.webContents.removeAllListeners("did-finish-load"),i.webContents.once("did-finish-load",(function(){i.webContents.send(g("display-screenshot"),t,r,h[n].size),i.webContents.send(g("set-lang"),i._captureLang||"zh")})),i.loadURL(x)):(i.webContents.removeAllListeners("did-finish-load"),i.webContents.once("did-finish-load",(function(){var o;i._isPageLoaded=!0,null===(o=e.logger)||void 0===o||o.call(e,"[screenshot-plugin] Window ".concat(n," first load completed")),i.webContents.send(g("display-screenshot"),t,r,h[n].size),i.webContents.send(g("set-lang"),i._captureLang||"zh")})),i.loadURL(x)))}));case 33:case"end":return t.stop()}}),t,null,[[14,22]])})));return function(e,n){return t.apply(this,arguments)}}()),s.on(g("screenshot-background-ready"),(function(t){var e=h.fromWebContents(t.sender);e&&m.includes(e)&&setTimeout((function(){e&&!e.isDestroyed()&&m.includes(e)&&e.showInactive()}),30)})),s.on(g("capture-done"),(function(t,n){var o,i;m.forEach((function(t){t.hide()})),M=!1,console.log("[screenshot-plugin] 截图已完成，状态已重置"),null===(o=e.exports)||void 0===o||null===(i=o.onCaptureDone)||void 0===i||i.call(o,n)})),s.on(g("custom-button-click"),function(){var t=l(o().mark((function t(n,i){var r,a,c,l;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,c=function(){var t;m.forEach((function(t){t.hide()})),M=!1,console.log("[screenshot-plugin] 自定义按钮已关闭，状态已重置"),null===(t=e.logger)||void 0===t||t.call(e,"[screenshot-plugin] Custom button - windows closed by user")},t.next=4,null===(r=e.config)||void 0===r||null===(r=r.customButton)||void 0===r||null===(a=r.callback)||void 0===a?void 0:a.call(r,i,c);case 4:t.next=12;break;case 6:t.prev=6,t.t0=t.catch(0),null===(l=e.logger)||void 0===l||l.call(e,"[screenshot-plugin] Custom button callback error: ".concat(t.t0.message)),m.forEach((function(t){t.hide()})),M=!1,console.log("[screenshot-plugin] 自定义按钮错误，状态已重置");case 12:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e,n){return t.apply(this,arguments)}}()),s.on(g("capture-cancel"),(function(){m.forEach((function(t){t.hide()})),M=!1,console.log("[screenshot-plugin] 截图已取消，状态已重置")})),s.handle(g("save-capture-image"),function(){var t=l(o().mark((function t(e,n){var i,r,a,c,l,s,d,u;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.base64Data,r=n.windowIndex,a=h.getAllWindows(),c=a.find((function(t){return t.captureWindowIndex===r})),l={title:"保存截图",defaultPath:"screenshot-".concat(Date.now(),".png"),filters:[{name:"PNG 图片",extensions:["png"]}]},y()||(l.modal=!0,l.alwaysOnTop=!0),t.next=7,w.showSaveDialog(c,l);case 7:if(!(s=t.sent).canceled){t.next=10;break}return t.abrupt("return",!1);case 10:if(!(d=s.filePath)){t.next=15;break}return u=i.replace(/^data:image\/\w+;base64,/,""),p.writeFileSync(d,u,"base64"),t.abrupt("return",!0);case 15:return t.abrupt("return",!1);case 16:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),s.on(g("check-display"),(function(t,e){var n=u.getAllDisplays(),o=null;n.forEach((function(t){var n=t.bounds,i=n.x,r=n.y,a=n.width,c=n.height;e.x>=i&&e.x<=i+a&&e.y>=r&&e.y<=r+c&&(o=t)})),m.forEach((function(t){var e,n,i,r=(null===(e=o)||void 0===e?void 0:e.id)===t.displayId;t.webContents.send(g("highlight-border"),null!==(n=null===(i=o)||void 0===i?void 0:i.id)&&void 0!==n?n:null),r&&o&&t.webContents.send(g("set-crop-limit"),o.bounds)}))})),s.handle(g("get-screenshot"),function(){var t=l(o().mark((function t(n,i){var r,a,c,l,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=u.getAllDisplays(),-1!==(a=r.findIndex((function(t){return String(t.id)===String(i.currentWindowIndex)})))){t.next=6;break}return null===(c=e.logger)||void 0===c||c.call(e,"[screenshot-plugin] Display not found for screenshot"),t.abrupt("return",null);case 6:return t.next=8,f({screen:a,format:"png"});case 8:return l=t.sent,t.abrupt("return","data:image/png;base64,".concat(l.toString("base64")));case 12:return t.prev=12,t.t0=t.catch(0),null===(s=e.logger)||void 0===s||s.call(e,"[screenshot-plugin] screenshot fail: "+t.t0.message),t.abrupt("return",null);case 16:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e,n){return t.apply(this,arguments)}}()),null===(r=e.logger)||void 0===r||r.call(e,"[screenshot-plugin] finished ipc register");case 23:case"end":return t.stop()}}),t)}))),I.apply(this,arguments)}t.exports={onUnload:function(){console.log("[screenshot-plugin] destroyed")},onLoad:function(t){return I.apply(this,arguments)}}},789:t=>{"use strict";t.exports=require("screenshot-desktop")},857:t=>{"use strict";t.exports=require("os")},896:t=>{"use strict";t.exports=require("fs")},928:t=>{"use strict";t.exports=require("path")}},e={};var n=function n(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={exports:{}};return t[o](r,r.exports,n),r.exports}(781);module.exports=n})();